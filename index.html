<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>MIDCARE© Capacity - Strategic Population Level</title>
  <script src="https://cdn.plot.ly/plotly-2.32.0.min.js"></script>
  <style>
    :root { --gap: 12px; }
    * { box-sizing: border-box; }
    body { margin: 0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; color: #111; }
    header { padding: 14px 16px; border-bottom: 1px solid #eee; display:flex; align-items:center; justify-content:space-between; gap:12px; flex-wrap:wrap;}
    .brand { display:flex; align-items:center; gap:10px; }
    .brand img { height:42px; width:auto; }
    .brand h1 { margin: 0; font-size: 20px; letter-spacing: 0.2px; }
    .toolbar { display:flex; align-items:center; gap:8px; flex-wrap:wrap; }
    .toolbar button, .toolbar select {
      padding: 8px 10px; border: 1px solid #ddd; background:#fff; border-radius:10px; cursor:pointer;
      box-shadow: 0 1px 2px rgba(0,0,0,0.04); font-weight:600;
    }
    .toolbar button:disabled { opacity:.5; cursor: default; }
    .wrap { max-width: 1200px; margin: 0 auto; padding: 16px; }

    /* SLIDERS: 4 across (2 rows × 4) */
    .controls {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: var(--gap);
      margin: 12px 0 16px;
    }
    .control.card {
      background: #fafafa; border: 1px solid #eee; border-radius: 12px;
      padding: 10px 12px; box-shadow: 0 1px 2px rgba(0,0,0,0.04);
      min-height: 140px; /* equal height cards */
      display: flex; flex-direction: column; justify-content: center;
    }
    .control label { display: block; font-weight: 600; font-size: 12px; margin-bottom: 6px; }
    .control input[type=range] { width: 100%; }
    .control .val { font-variant-numeric: tabular-nums; font-size: 12px; color: #444; margin-top: 4px; }

    /* GRAPHS: 4 across to match sliders */
    .plots {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: var(--gap);
      margin-top: 8px;
    }
    .plotcard {
      background:#fff; border:1px solid #eee; border-radius:12px;
      box-shadow: 0 1px 2px rgba(0,0,0,0.04);
      min-height: 260px; /* equal card height for symmetry */
      display:flex; flex-direction:column;
    }
    .plotTitle { font-size: 13px; font-weight: 600; margin: 8px 10px 0 10px; color: #222; }
    .plotbox { height: 220px; margin: 6px 6px 10px 6px; } /* fixed inner plot height */

    #legendNote { margin: 8px 0 12px; font-size: 12px; color: #444; }
    .legendSwatch { display:inline-block; width:10px; height:10px; vertical-align:middle; margin-right:6px; border-radius:2px; }
    .red { background:#d62728; } .blue { background:#1f77b4; }

    /* References list */
    .refs { margin-top:16px; }
    .refs h2 { font-size:16px; margin:8px 0; }
    .refs ul { font-size:13px; line-height:1.6; margin-left:20px; }
    .refs a { color:#0044cc; text-decoration: none; }
    .refs a:hover { text-decoration: underline; }

    /* Responsive */
    @media (max-width: 1100px) {
      .controls, .plots { grid-template-columns: repeat(2, 1fr); }
    }
    @media (max-width: 640px) {
      .controls, .plots { grid-template-columns: 1fr; }
      .plotbox { height: 200px; }
    }
  </style>
</head>
<body>
  <header>
    <div class="brand">
      <img src="https://assets.zyrosite.com/AoP61N2BR4i8Q6jl/logo-hsml-AE07eKDgMLFgWBoQ.png" alt="MIDCARE / HSML Logo">
      <h1>MIDCARE© Capacity - Strategic Population Level</h1>
    </div>
    <div class="toolbar">
      <label for="endYear" style="font-weight:600;">End year</label>
      <select id="endYear" title="Select end year"></select>
      <button id="play">▶ Run</button>
      <button id="pause" disabled>⏸ Pause</button>
      <button id="reset">⟲ Reset</button>
      <span id="yearLabel" style="margin-left:8px;font-weight:600;">Selected year: 2065</span>
    </div>
  </header>

  <div class="wrap">
    <!-- ALL 8 SLIDERS (4 across) -->
    <div class="controls">
      <div class="control card">
        <label>Population growth rate (annual)</label>
        <input id="popRate" type="range" min="0.0" max="0.03" step="0.0001" value="0.019">
        <div class="val"><span id="popRateVal">1.90%</span> / yr</div>
      </div>
      <div class="control card">
        <label>Consultant increase rate (annual)</label>
        <input id="consRate" type="range" min="0.0" max="0.10" step="0.0005" value="0.06">
        <div class="val"><span id="consRateVal">6.00%</span> / yr</div>
      </div>
      <div class="control card">
        <label>Model 2 bed growth multiplier</label>
        <input id="bedRate2" type="range" min="0.95" max="1.05" step="0.001" value="1.000">
        <div class="val">× <span id="bedRate2Val">1.000</span></div>
      </div>
      <div class="control card">
        <label>Model 4 bed growth rate (annual)</label>
        <input id="bedRate4" type="range" min="0.00" max="0.20" step="0.0005" value="0.035">
        <div class="val"><span id="bedRate4Val">3.50%</span> / yr</div>
      </div>
      <div class="control card">
        <label>Optimal bed occupancy (fraction)</label>
        <input id="optOcc" type="range" min="0.70" max="0.95" step="0.005" value="0.85">
        <div class="val"><span id="optOccVal">0.85</span></div>
      </div>
      <div class="control card">
        <label>Normal length of stay (days)</label>
        <input id="los" type="range" min="3" max="12" step="0.1" value="6.0">
        <div class="val"><span id="losVal">6.4</span> days</div>
      </div>
      <div class="control card">
        <label>Normal specialist-to-bed ratio <small>(per 1,000 bed-days)</small></label>
        <input id="normSpecBed" type="range" min="0.2" max="2.0" step="0.001" value="0.904">
        <div class="val"><span id="normSpecBedVal">0.904</span></div>
      </div>
      <div class="control card">
        <label>Normal bed-to-patient ratio</label>
        <input id="normBedPat" type="range" min="0.001" max="0.01" step="0.0001" value="0.00268">
        <div class="val"><span id="normBedPatVal">0.00268</span> beds/person</div>
      </div>
    </div>

    <div id="legendNote">
      <span class="legendSwatch red"></span>Historic to 2025 &nbsp;&nbsp;
      <span class="legendSwatch blue"></span>Projection from 2025 (animated)
    </div>

    <!-- 4 GRAPHS (4 across) -->
    <div class="plots">
      <div class="plotcard">
        <div class="plotTitle">Population — Midwest</div>
        <div id="popPlot" class="plotbox"></div>
      </div>
      <div class="plotcard">
        <div class="plotTitle">Consultants — Headcount</div>
        <div id="consPlot" class="plotbox"></div>
      </div>
      <div class="plotcard">
        <div class="plotTitle">Model 2 Beds</div>
        <div id="cap2Plot" class="plotbox"></div>
      </div>
      <div class="plotcard">
        <div class="plotTitle">Model 4 Beds</div>
        <div id="cap4Plot" class="plotbox"></div>
      </div>
    </div>

    <!-- REFERENCES BELOW THE GRAPHS -->
    <div class="refs">
      <h2>Data Sources for Default Parameters (National & Midwest)</h2>
      <ul>
        <li><strong>Population growth rate (National 1.9%)</strong> — <a href="https://www.cso.ie/en/releasesandpublications/ep/p-pme/populationandmigrationestimatesapril2024/" target="_blank" rel="noopener">CSO – Population &amp; Migration Estimates April 2024</a>; <em>Midwest baseline</em>: historic mean (model)</li>
        <li><strong>Consultant increase rate (National 6.0%)</strong> — <a href="https://www.hse.ie/eng/staff/leadership-education-development/met/plan/medical-workforce-analysis-report-2024-2025.pdf" target="_blank" rel="noopener">HSE – Medical Workforce Analysis Report 2024–2025 (PDF)</a>; <em>Midwest baseline</em>: 3.5% (model)</li>
        <li><strong>Model 2 bed growth multiplier (National ×1.000)</strong> — <a href="https://assets.gov.ie/static/documents/acute-hospital-inpatient-bed-capacity-expansion-plan.pdf" target="_blank" rel="noopener">Acute Hospital Inpatient Bed Capacity Expansion Plan (PDF)</a>; <em>Midwest baseline</em>: ×0.999 (internal calibration)</li>
        <li><strong>Model 4 bed growth rate (National 3.5%)</strong> — <a href="https://assets.gov.ie/static/documents/acute-hospital-inpatient-bed-capacity-expansion-plan.pdf" target="_blank" rel="noopener">Acute Hospital Inpatient Bed Capacity Expansion Plan (PDF)</a>; <em>Midwest baseline</em>: 9.9% (model)</li>
        <li><strong>Optimal bed occupancy (0.85)</strong> — <a href="https://www.nice.org.uk/guidance/ng94/evidence/39.bed-occupancy-pdf-172397464704." target="_blank" rel="noopener">NICE/HIQA – Bed Occupancy context</a></li>
        <li><strong>Normal length of stay (National 6.0 days)</strong> — <a href="https://www.gov.ie/en/department-of-health/collections/national-healthcare-statistics-2025/" target="_blank" rel="noopener">HIPE – Activity in Acute Public Hospitals in Ireland 2022 Annual Report (PDF)</a>; <em>Midwest baseline</em>: 5.0 days (model)</li>
        <li><strong>Specialists (per 1,000 bed-days) (National 0.904)</strong> — <a href="https://www.ihca.ie/news-and-publications/number-of-unfilled-consultant-posts-increases-to-728-45-more-than-previously-believed-%E2%80%93-new-data-analysis#:~:text=Ending%20the%20waiting%20lists,increased%20patient%20demand%20to%202028." target="_blank" rel="noopener">IHCA analysis referencing OECD Health Statistics</a>; <em>Midwest baseline</em>: 0.557 (model)</li>
        <li><strong>Beds per person (National 0.00268)</strong> — <a href="https://ec.europa.eu/eurostat/statistics-explained/index.php?title=Healthcare_resource_statistics_-_beds" target="_blank" rel="noopener">Eurostat – Healthcare resource statistics: beds</a>; <em>Midwest baseline</em>: 0.0051 (model)</li>
      </ul>
    </div>
  </div>

<script>
(function() {
  // Years and historic series
  const YEARS_ALL = Array.from({length: (2100 - 2009 + 1)}, (_, i) => 2009 + i);
  const YEARS_HIST = YEARS_ALL.filter(y => y <= 2025);
  const POP_H  = [361028,370177.5,379327,380496,381665,382834,384003,385172,389723.1667,394274.3333,398825.5,403376.6667,407927.8333,412479,412479,412479,412479];
  const CONS_H = [129,132,135,138,141,145,149,153,157,161,165,176,174,189.5,205,234,240];
  const CAP2_H = [179,179,175,172,189,185,177,178,167,186,187,184,184,184,184,184,184];
  const CAP4_H = [420,404,401,403,367,354,357,426,421,444,434,460,516,522.3333,528.6667,535,535];

  const DEFAULTS = {
    END_YEAR: 2065,
    POP_RATE: 0.019,
    CONS_RATE: 0.06,
    BED_RATE2_MULT: 1.000,
    BED_RATE4: 0.035,
    OPT_OCC: 0.85,
    NORM_LOS: 6.4,
    NORM_SPEC_TO_BED: 0.904,
    NORM_BED_TO_PAT: 0.00268
  };

  let END_YEAR = DEFAULTS.END_YEAR;
  let POP_RATE  = DEFAULTS.POP_RATE;
  let CONS_RATE = DEFAULTS.CONS_RATE;
  let BED_RATE2_MULT = DEFAULTS.BED_RATE2_MULT;
  let BED_RATE4 = DEFAULTS.BED_RATE4;
  let OPT_OCC = DEFAULTS.OPT_OCC;
  let NORM_LOS = DEFAULTS.NORM_LOS;
  let NORM_SPEC_TO_BED = DEFAULTS.NORM_SPEC_TO_BED;
  let NORM_BED_TO_PAT  = DEFAULTS.NORM_BED_TO_PAT;

  const $ = (id) => document.getElementById(id);
  const play = $("play");
  const pauseBtn = $("pause");
  const yearLabel = $("yearLabel");
  const endYearSel = $("endYear");

  function populateEndYearOptions() {
    endYearSel.innerHTML = "";
    for (let y = 2025; y <= 2100; y++) {
      const opt = document.createElement("option");
      opt.value = y;
      opt.textContent = y;
      endYearSel.appendChild(opt);
    }
    endYearSel.value = String(DEFAULTS.END_YEAR);
  }
  populateEndYearOptions();

  const idxOfYear = (y) => YEARS_ALL.indexOf(y);

  function simulateProjection() {
    const i2025 = YEARS_HIST.length - 1;
    const basePop = POP_H[i2025];
    const baseC   = CONS_H[i2025];
    const baseK2  = CAP2_H[i2025];
    const baseK4  = CAP4_H[i2025];

    const yearsProj = YEARS_ALL.slice(idxOfYear(2025));
    const pop = [basePop], cons = [baseC], k2 = [baseK2], k4 = [baseK4];

    for (let t = 1; t < yearsProj.length; t++) {
      const P  = pop[t-1];
      const C  = cons[t-1];
      const K2 = k2[t-1];
      const K4 = k4[t-1];

      const totalBedsDays = (K2 + K4) * 365;
      const patients = 0.194 * P + C * (413590.0/234.0);

      const m2_ratio = totalBedsDays > 0 ? (K2 * 365) / totalBedsDays : 0;
      const lengthOfStay = 1 + (NORM_LOS * m2_ratio);

      const required  = patients * lengthOfStay * 1.0;
      const occupied  = Math.min(required, totalBedsDays * OPT_OCC);
      const occupancy = totalBedsDays > 0 ? occupied / totalBedsDays : 0;
      const rate_effect1 = OPT_OCC - occupancy;

      const bedToPatientRatio = patients > 0 ? K4 / patients : 0;
      const rate_effect3 = BED_RATE4 * (bedToPatientRatio / NORM_BED_TO_PAT);

      const specToBed = totalBedsDays > 0 ? (C / Math.max(1,totalBedsDays)) * 1000 : 0;
      const current_effect2 = Math.max(0, Math.min(0.06, CONS_RATE * (specToBed / NORM_SPEC_TO_BED)));

      const dP  = POP_RATE * P;
      const dC  = C * current_effect2;

      const dK2 = (K2 < 800)  ? (K2 * Math.max(0.02035, rate_effect1) * BED_RATE2_MULT) : 0;
      const dK4 = (K4 < 1500) ? (K4 * Math.max(0.03, rate_effect3)) : 0;

      pop.push(P + dP);
      cons.push(C + dC);
      k2.push(K2 + dK2);
      k4.push(K4 + dK4);
    }
    return { yearsProj, pop, cons, k2, k4 };
  }

  function computeYRange(hist, projSlice) {
    const all = hist.concat(projSlice);
    const min = Math.min.apply(null, all);
    const max = Math.max.apply(null, all);
    const pad = (max - min) * 0.08 || 1;
    return [Math.max(0, min - pad), max + pad];
  }
  const cfg = { responsive:true, displaylogo:false };

  function mkLayout(yTitle, yRange, {xTitle=""} = {}) {
    return {
      margin:{l:50,r:6,t:10,b:36},
      height: 220,
      xaxis:{ title:{text:xTitle}, titlefont:{size:11}, tickfont:{size:10}, automargin:true, range:[2009, END_YEAR] },
      yaxis:{ title:{text:yTitle}, titlefont:{size:11}, tickfont:{size:10}, automargin:true, range:yRange },
      showlegend:false
    };
  }

  function initialPlots() {
    const xHist = YEARS_HIST;
    Plotly.newPlot("popPlot",  [
      {x:xHist,y:POP_H,  mode:"lines", line:{color:"#d62728", width:2}}
    ], mkLayout("People", computeYRange(POP_H, [POP_H.at(-1)]), {xTitle:"Year"}), cfg);

    Plotly.newPlot("consPlot", [
      {x:xHist,y:CONS_H, mode:"lines", line:{color:"#d62728", width:2}}
    ], mkLayout("Consultants", computeYRange(CONS_H, [CONS_H.at(-1)]), {xTitle:"Year"}), cfg);

    Plotly.newPlot("cap2Plot", [
      {x:xHist,y:CAP2_H, mode:"lines", line:{color:"#d62728", width:2}}
    ], mkLayout("Model 2 Beds", computeYRange(CAP2_H, [CAP2_H.at(-1)]), {xTitle:"Year"}), cfg);

    Plotly.newPlot("cap4Plot", [
      {x:xHist,y:CAP4_H, mode:"lines", line:{color:"#d62728", width:2}}
    ], mkLayout("Model 4 Beds", computeYRange(CAP4_H, [CAP4_H.at(-1)]), {xTitle:"Year"}), cfg);
  }

  let timer = null;
  const msPerFrame = 200;
  let proj = null;
  let frameIdx = 0;

  function addBlueTracesIfMissing() {
    const addIf = (divId, y0) => {
      const gd = document.getElementById(divId);
      if (gd.data.length === 1) {
        Plotly.addTraces(divId, {x:[2025], y:[y0], mode:"lines", line:{color:"#1f77b4", width:3}});
      }
    };
    addIf("popPlot",  POP_H.at(-1));
    addIf("consPlot", CONS_H.at(-1));
    addIf("cap2Plot", CAP2_H.at(-1));
    addIf("cap4Plot", CAP4_H.at(-1));
  }

  function renderFrame(i) {
    const years = proj.yearsProj.slice(0, i+1);
    const yrPop  = computeYRange(POP_H,  proj.pop.slice(0, i+1));
    const yrCons = computeYRange(CONS_H, proj.cons.slice(0, i+1));
    const yrK2   = computeYRange(CAP2_H, proj.k2.slice(0, i+1));
    const yrK4   = computeYRange(CAP4_H, proj.k4.slice(0, i+1));

    Plotly.restyle("popPlot",  {x:[YEARS_HIST, years], y:[POP_H,  proj.pop.slice(0,i+1)]});
    Plotly.relayout("popPlot", { "yaxis.range": yrPop, "xaxis.range":[2009, END_YEAR] });

    Plotly.restyle("consPlot", {x:[YEARS_HIST, years], y:[CONS_H, proj.cons.slice(0,i+1)]});
    Plotly.relayout("consPlot", { "yaxis.range": yrCons, "xaxis.range":[2009, END_YEAR] });

    Plotly.restyle("cap2Plot",{x:[YEARS_HIST, years], y:[CAP2_H, proj.k2.slice(0,i+1)]});
    Plotly.relayout("cap2Plot",{ "yaxis.range": yrK2, "xaxis.range":[2009, END_YEAR] });

    Plotly.restyle("cap4Plot",{x:[YEARS_HIST, years], y:[CAP4_H, proj.k4.slice(0,i+1)]});
    Plotly.relayout("cap4Plot",{ "yaxis.range": yrK4, "xaxis.range":[2009, END_YEAR] });

    yearLabel.textContent = "Selected year: " + years.at(-1);
  }

  function start() {
    play.disabled = true; 
    pauseBtn.disabled = false;
    proj = simulateProjection();
    addBlueTracesIfMissing();
    frameIdx = 0;
    renderFrame(frameIdx);
    if (timer) clearInterval(timer);
    timer = setInterval(() => {
      frameIdx += 1;
      const maxFrames = (END_YEAR - 2025);
      if (frameIdx > maxFrames) { pause(); return; }
      renderFrame(frameIdx);
    }, msPerFrame);
  }

  function pause() { 
    play.disabled = false; 
    pauseBtn.disabled = true; 
    if (timer) clearInterval(timer); 
    timer = null; 
  }

  function reset() {
    pause();
    END_YEAR           = DEFAULTS.END_YEAR;
    POP_RATE           = DEFAULTS.POP_RATE;
    CONS_RATE          = DEFAULTS.CONS_RATE;
    BED_RATE2_MULT     = DEFAULTS.BED_RATE2_MULT;
    BED_RATE4          = DEFAULTS.BED_RATE4;
    OPT_OCC            = DEFAULTS.OPT_OCC;
    NORM_LOS           = DEFAULTS.NORM_LOS;
    NORM_SPEC_TO_BED   = DEFAULTS.NORM_SPEC_TO_BED;
    NORM_BED_TO_PAT    = DEFAULTS.NORM_BED_TO_PAT;

    $("popRate").value      = String(POP_RATE);
    $("consRate").value     = String(CONS_RATE);
    $("bedRate2").value     = String(BED_RATE2_MULT);
    $("bedRate4").value     = String(BED_RATE4);
    $("optOcc").value       = String(OPT_OCC);
    $("los").value          = String(NORM_LOS);
    $("normSpecBed").value  = String(NORM_SPEC_TO_BED);
    $("normBedPat").value   = String(NORM_BED_TO_PAT);

    $("popRateVal").textContent     = (POP_RATE*100).toFixed(2) + "%";
    $("consRateVal").textContent    = (CONS_RATE*100).toFixed(2) + "%";
    $("bedRate2Val").textContent    = Number(BED_RATE2_MULT).toFixed(3);
    $("bedRate4Val").textContent    = (BED_RATE4*100).toFixed(2) + "%";
    $("optOccVal").textContent      = OPT_OCC.toFixed(2);
    $("losVal").textContent         = Number(NORM_LOS).toFixed(1);
    $("normSpecBedVal").textContent = Number(NORM_SPEC_TO_BED).toFixed(3);
    $("normBedPatVal").textContent  = Number(NORM_BED_TO_PAT).toFixed(5);

    endYearSel.value = String(DEFAULTS.END_YEAR);
    yearLabel.textContent = "Selected year: " + DEFAULTS.END_YEAR;

    proj = simulateProjection();
    frameIdx = 0;
    initialPlots();
  }

  function updateParams() {
    POP_RATE         = parseFloat($("popRate").value);
    CONS_RATE        = parseFloat($("consRate").value);
    BED_RATE2_MULT   = parseFloat($("bedRate2").value);
    BED_RATE4        = parseFloat($("bedRate4").value);
    OPT_OCC          = parseFloat($("optOcc").value);
    NORM_LOS         = parseFloat($("los").value);
    NORM_SPEC_TO_BED = parseFloat($("normSpecBed").value);
    NORM_BED_TO_PAT  = parseFloat($("normBedPat").value);

    $("popRateVal").textContent     = (POP_RATE*100).toFixed(2) + "%";
    $("consRateVal").textContent    = (CONS_RATE*100).toFixed(2) + "%";
    $("bedRate2Val").textContent    = Number(BED_RATE2_MULT).toFixed(3);
    $("bedRate4Val").textContent    = (BED_RATE4*100).toFixed(2) + "%";
    $("optOccVal").textContent      = OPT_OCC.toFixed(2);
    $("losVal").textContent         = Number(NORM_LOS).toFixed(1);
    $("normSpecBedVal").textContent = Number(NORM_SPEC_TO_BED).toFixed(3);
    $("normBedPatVal").textContent  = Number(NORM_BED_TO_PAT).toFixed(5);

    proj = simulateProjection();
    frameIdx = 0;
    pause();
    yearLabel.textContent = "Selected year: " + END_YEAR;
    initialPlots();
  }
  ["popRate","consRate","bedRate2","bedRate4","optOcc","los","normSpecBed","normBedPat"].forEach(id => {
    $(id).addEventListener("input", updateParams);
    $(id).addEventListener("change", updateParams);
  });

  endYearSel.addEventListener("change", () => {
    END_YEAR = parseInt(endYearSel.value, 10);
    frameIdx = 0;
    pause();
    yearLabel.textContent = "Selected year: " + END_YEAR;
    initialPlots();
  });

  initialPlots();
  yearLabel.textContent = "Selected year: " + DEFAULTS.END_YEAR;

  play.addEventListener("click", start);
  pauseBtn.addEventListener("click", pause);
  $("reset").addEventListener("click", reset);
})();
</script>
</body>
</html>





